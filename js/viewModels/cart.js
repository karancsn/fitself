define(["require","exports","knockout","ojs/ojconverter-number","ojs/ojknockouttemplateutils","ojs/ojmodule-element-utils","ojs/ojarraydataprovider","../accUtils","../appController","ojs/ojtable","ojs/ojcheckboxset","ojs/ojbutton","ojs/ojinputnumber","../interfaces"],(function(require,e,t,r,a,i,o,s,l){"use strict";class n{constructor(e){this.decimalAdder=(e,t,r)=>{let a=parseFloat((100*e).toFixed(2)),i=parseFloat((100*t*r).toFixed(2));return parseFloat((a+i).toFixed(2))/100},this.sku=e.sku,this.name=e.name,this.flavour=e.flavour,this.quantity=e.quantity,this.unit=e.unit,this.packSize=e.packSize,this.unitPrice=e.mrp,this.inCartCount=t.observable(e.inCartCount()),this.volumePoints=this.decimalAdder(0,this.inCartCount(),e.volumePoints),this.mrp=this.decimalAdder(0,this.inCartCount(),e.mrp),this.price25=this.decimalAdder(0,this.inCartCount(),e.price25),this.price35=this.decimalAdder(0,this.inCartCount(),e.price35),this.price42=this.decimalAdder(0,this.inCartCount(),e.price42),this.price50=this.decimalAdder(0,this.inCartCount(),e.price50),this.dispName=this.name+" - "+this.flavour+" "+this.quantity+" "+this.unit}}return class{constructor(e){this.parametersChanged=e=>{console.log(e)},this.backToOrder=()=>{this.args.router.go({path:"order"})},this.numberComparator=(e,t)=>e-t,this.stringComparator=(e,t)=>e.localeCompare(t),this.vpConverter=new r.IntlNumberConverter({style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2,useGrouping:!0}),this.amountConverter=new r.IntlNumberConverter({style:"decimal",minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!0}),this.decimalAdder=(e,t,r)=>{let a=parseFloat((100*e).toFixed(2)),i=parseFloat((100*t*r).toFixed(2));return parseFloat((a+i).toFixed(2))/100},this.priceTotaller=e=>{if(!this.columnArray()[e.columnIndex])return;let t=0;return this.cartTableData.forEach((r=>{switch(this.columnArray()[e.columnIndex].headerText){case"Mrp":t=this.decimalAdder(t,1,r.mrp);break;case"25%":t=this.decimalAdder(t,1,r.price25);break;case"35%":t=this.decimalAdder(t,1,r.price35);break;case"42%":t=this.decimalAdder(t,1,r.price42);break;case"50%":t=this.decimalAdder(t,1,r.price50);break;case"Vp":t=this.decimalAdder(t,1,r.volumePoints)}})),t||void 0},this.args=e,this.headerConfig=t.observable({view:[],viewModel:null}),this.footerConfig=t.observable({view:[],viewModel:null}),this.effectiveDate=this.args.routerState.detail.effectiveDate,this.cartProdItems=this.args.routerState.detail.cartData,0===this.cartProdItems().length&&this.backToOrder(),this.cartTableData=[],this.cartProdItems().forEach((e=>{this.cartTableData.push(new n(e))})),this.cartDataProvider=new o(this.cartTableData,{keyAttributes:"sku",sortComparators:{comparators:(new Map).set("dispName",this.stringComparator).set("inCartCount",this.numberComparator).set("volumePoints",this.numberComparator).set("unitPrice",this.numberComparator)}}),this.columnArray=t.observableArray([{sortable:"enabled",headerText:"Item",headerClassName:"cart-table-header-row",style:"white-space: normal; word-wrap: break-word; text-align: left;",footerClassName:"oj-typography-bold",footerRenderer:a.getRenderer("item-total-label",!0),renderer:a.getRenderer("item-name",!0),sortProperty:"dispName"},{sortable:"enabled",headerText:"Q",headerClassName:"cart-table-header-row oj-helper-text-align-end",className:"oj-helper-text-align-end",footerClassName:"oj-helper-text-align-end",footerRenderer:a.getRenderer("item-total-quantity",!0),field:"inCartCount"},{sortable:"enabled",sortProperty:"volumePoints",headerText:"Vp",headerClassName:"cart-table-header-row oj-helper-text-align-end",className:"oj-helper-text-align-end",renderer:a.getRenderer("item-vol-points",!0),footerClassName:"oj-helper-text-align-end",footerRenderer:a.getRenderer("item-total-volume",!0)},{sortable:"enabled",sortProperty:"unitPrice",headerText:"Unit Price",headerClassName:"cart-table-header-row oj-helper-text-align-end",className:"oj-helper-text-align-end",renderer:a.getRenderer("item-unit-price",!0)},{sortable:"disabled",headerText:"Mrp",headerClassName:"cart-table-header-row oj-helper-text-align-end",className:"oj-helper-text-align-end",minWidth:"90px",renderer:a.getRenderer("item-retail-price",!0),footerClassName:"oj-helper-text-align-end",footerRenderer:a.getRenderer("item-total-price",!0)}]),i.createView({viewPath:"views/footer.html"}).then((e=>{this.footerConfig({view:e,viewModel:{}}),i.createView({viewPath:"views/header.html"}).then((e=>{this.headerConfig({view:e,viewModel:l.default.getHeaderModel()})}))})),this.itemCount=t.pureComputed((()=>this.cartProdItems().reduce(((e,t)=>e+t.inCartCount()),0))),this.cartDiscountSelected=t.observableArray(),this.discountOptions=t.observableArray([{id:"p25opt",value:"price25",disc:"25%"},{id:"p35opt",value:"price35",disc:"35%"},{id:"p42opt",value:"price42",disc:"42%"},{id:"p50opt",value:"price50",disc:"50%"}]),this.addDiscCol=t.computed((()=>{this.columnArray.splice(5);for(let e=0;e<this.cartDiscountSelected().length;e++){switch(this.cartDiscountSelected()[e]){case"price25":this.columnArray.push({sortable:"disabled",headerText:"25%",headerClassName:"cart-table-header-row oj-helper-text-align-end",minWidth:"90px",className:"oj-helper-text-align-end",renderer:a.getRenderer("item-disc-25",!0),footerClassName:"oj-helper-text-align-end",footerRenderer:a.getRenderer("item-total-price",!0)});break;case"price35":this.columnArray.push({sortable:"disabled",headerText:"35%",headerClassName:"cart-table-header-row oj-helper-text-align-end",minWidth:"90px",className:"oj-helper-text-align-end",renderer:a.getRenderer("item-disc-35",!0),footerClassName:"oj-helper-text-align-end",footerRenderer:a.getRenderer("item-total-price",!0)});break;case"price42":this.columnArray.push({sortable:"disabled",headerText:"42%",headerClassName:"cart-table-header-row oj-helper-text-align-end",className:"oj-helper-text-align-end",minWidth:"90px",footerClassName:"oj-helper-text-align-end",footerRenderer:a.getRenderer("item-total-price",!0),renderer:a.getRenderer("item-disc-42",!0)});break;case"price50":this.columnArray.push({sortable:"disabled",headerText:"50%",headerClassName:"cart-table-header-row oj-helper-text-align-end",className:"oj-helper-text-align-end",minWidth:"90px",footerClassName:"oj-helper-text-align-end",footerRenderer:a.getRenderer("item-total-price",!0),renderer:a.getRenderer("item-disc-50",!0)})}}}))}connected(){s.announce("Cart page loaded."),document.title="Cart"}disconnected(){}transitionCompleted(){}}}));