define(["require","exports","knockout","ojs/ojmodule-element-utils","ojs/ojconverter-number","ojs/ojmodel","ojs/ojkeyset","ojs/ojarraytreedataprovider","ojs/ojcollectiondataprovider","../accUtils","../appController","text!../../../resources/data.json","ojs/ojbutton","ojs/ojinputnumber","ojs/ojinputtext","ojs/ojlistitemlayout","ojs/ojlistview","ojs/ojtable","../interfaces"],(function(require,t,e,i,r,o,a,s,d,l,n,u){"use strict";class h{constructor(t){this.sku=t.sku,this.name=t.name,this.flavour=t.flavour,this.quantity=t.quantity,this.unit=t.unit,this.packSize=t.packSize,this.volumePoints=t.volumePoints,this.mrp=t.mrp,this.price25=t.price25,this.price35=t.price35,this.price42=t.price42,this.price50=t.price50,this.inCartCount=e.observable(0)}}return class{constructor(t){this.handleInputNumber=(t,e)=>{0===t.detail.value&&this.cartProdItems.remove((t=>t.sku===e.key))},this.handleRawValueChanged=t=>{let e=t.detail.value;if(0===e.length)this.dataProvider()==this.filteredDataProvider&&this.dataProvider(this.prodDataProvider);else{null==this.filteredDataProvider&&(this.collection=this.flattenJSON(this.productCatalogue()),this.filteredCollection=this.collection.clone(),this.filteredDataProvider=new d(this.filteredCollection));let t=this.collection.where({name:{value:e,comparator:this.nameFilter}});this.filteredCollection.reset(t),this.dataProvider()==this.prodDataProvider&&this.dataProvider(this.filteredDataProvider)}},this.addToCart=(t,e,i)=>{e&&e.data&&(this.cartProdItems.remove((t=>t.sku===e.data.sku)),e.data.inCartCount(e.data.inCartCount()+1),this.cartProdItems.push(e.data))},this.checkout=(t,e,i)=>{this.args.router.go({path:"cart"})},this.prepareListData=t=>{this.effectiveDate(t.effectiveDate);let e=[];for(let i of t.items){let t=new ProductCategory(i.category);for(let e of i.products)t.add(new h(e));e.push(t)}this.productCatalogue(e)},this.emptyCart=t=>(this.cartProdItems.removeAll(),this.productCatalogue().forEach((t=>{t.products.forEach((t=>{t.inCartCount(0)}))})),!0),this.args=t,this.headerConfig=e.observable({view:[],viewModel:null}),this.footerConfig=e.observable({view:[],viewModel:null}),this.expanded=new a.ExpandAllKeySet,this.prodDataProvider=new s([]),this.dataProvider=e.observable(this.prodDataProvider),this.filterVal=e.observable(),this.noGroupingNumberConverter=new r.IntlNumberConverter({style:"decimal",minimumIntegerDigits:1,minimumFractionDigits:0,maximumFractionDigits:0,useGrouping:!1}),this.effectiveDate=this.args.routerState.detail.effectiveDate,this.cartProdItems=this.args.routerState.detail.cartData,this.productCatalogue=this.args.routerState.detail.prodData,0===this.productCatalogue().length&&this.prepareListData(JSON.parse(u)),this.prodDataProvider=new s(this.productCatalogue,{keyAttributes:"sku",childrenAttribute:"products"}),this.dataProvider(this.prodDataProvider),i.createView({viewPath:"views/footer.html"}).then((t=>{this.footerConfig({view:t,viewModel:{}}),i.createView({viewPath:"views/header.html"}).then((t=>{this.headerConfig({view:t,viewModel:n.default.getHeaderModel()})}))})),this.itemCount=e.pureComputed((()=>this.cartProdItems().reduce(((t,e)=>t+e.inCartCount()),0)))}connected(){l.announce("Order page loaded."),document.title="Order"}disconnected(){}transitionCompleted(){}flattenJSON(t){let e=o.Model.extend({idAttribute:"sku"}),i=new o.Collection(void 0,{model:e});for(let e of t)for(let t of e.products)i.add(t);return i}nameFilter(t,e,i){return t.get("name").toLowerCase().indexOf(i.toLowerCase())>-1}fadeIn(t,e){t&&function i(r=0){t.style.opacity=String(r),"1"!==t.style.opacity?setTimeout((()=>{i(r+.1)}),e/10):t.classList.remove("hide")}()}fadeOut(t,e){t&&function i(){let r=Number(t.style.opacity)-.1;t.style.opacity=String(r),r<0?t.classList.add("hide"):setTimeout((()=>{i()}),e/10)}()}itemOnly(t){return t.leaf}}}));