/*! For license information please see 778.10fc2c3423c443bd821d.js.LICENSE.txt */
(self.webpackChunkfitself=self.webpackChunkfitself||[]).push([[778],{7038:(e,t,r)=>{"use strict";r.r(t),r.d(t,{TabbableModeContext:()=>s,useTabbableMode:()=>o});var n=r(6400),a=r(396);const s=(0,n.createContext)({isTabbable:!0});function o(){const{isTabbable:e}=(0,a.useContext)(s);return{isTabbable:e,tabbableModeProps:{tabIndex:!1===e?-1:0}}}},4016:(e,t,r)=>{var n,a;n=[t,r(1857)],a=function(e,t){"use strict";e.CspExpressionEvaluatorInternal=function(e){var r=new t.ExpParser,n=Object.assign({},e);n.globalScope&&n.globalScope.Object||(n.globalScope=Object.assign({Object},n.globalScope)),this.createEvaluator=function(e){var t;try{t=r.parse(e)}catch(t){p(t,e)}var a=n.globalScope;return{evaluate:function(r){var n,s=r;a&&(s=r.concat([a]));try{n=i(t,s)}catch(t){p(t,e)}return n}}},this.evaluate=function(e,t){return i(e,[t])};var a={"||":function(e,t){return e||t()},"&&":function(e,t){return e&&t()},"|":function(e,t){return e|t},"^":function(e,t){return e^t},"&":function(e,t){return e&t},"==":function(e,t){return e==t},"!=":function(e,t){return e!=t},"===":function(e,t){return e===t},"!==":function(e,t){return e!==t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},"<<":function(e,t){return e<<t},">>":function(e,t){return e>>t},">>>":function(e,t){return e>>>t},"+":function(e,t){return e+t},"-":function(e,t){return e-t},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"%":function(e,t){return e%t}},s={"-":function(e){return-e},"+":function(e){return e},"~":function(e){return~e},"!":function(e){return!e},"...":function(e){return new o(e)}};function o(e){this.items=function(){return e}}function i(e,t){switch(e.type){case 1:return function(e,t){var r=u(e,t);if(r)return r[t];throw new Error("Variable "+t+" is undefined")}(t,e.name);case 2:return d(e,t)[1];case 3:return e.value;case 4:var r,n,o;switch(e.callee.type){case 1:o=function(e,t){var r=u(e,t);if(r)return[r,r[t]];throw new Error("Variable "+t+" is undefined")}(t,e.callee.name);break;case 2:o=d(e.callee,t);break;default:n=i(e.callee,t)}return!n&&Array.isArray(o)&&(r=o[0],n=o[1]),"function"!=typeof n&&l("Expression is not a function"),n.apply(r,c(e.arguments,t));case 5:return s[e.operator](i(e.argument,t));case 6:return"="===e.operator?function(e,t,r){switch(e.type){case 1:var n=e.name,a=u(t,n);a||l("Cannot assign value to undefined variable "+n),a[n]=r;break;case 2:var s=e.computed?i(e.property,t):e.property.name;d(e,t)[0][s]=r;break;default:l("Expression of type: "+e.type+" not supported for assignment")}return r}(e.left,t,i(e.right,t)):a[e.operator](i(e.left,t),i(e.right,t));case 7:return a[e.operator](i(e.left,t),(function(){return i(e.right,t)}));case 8:return i(e.test,t)?i(e.consequent,t):i(e.alternate,t);case 9:return c(e.elements,t);case 10:return function(e,t){return e.properties.reduce((function(e,r){return e[r.key]=i(r.value,t),e}),{})}(e,t);case 11:return function(e,t){return function(){var r=arguments,n=e.arguments.reduce((function(e,t,n){return e[t.name]=r[n],e}),{});n.this=this;try{var a=i(e.body,[n].concat(t));if(e.return)return a}catch(t){p(t,e.expr)}}}(e,t);case 12:return function(e,t){var r=i(e.callee,t);return r instanceof Function||l("Node of type "+e.callee.type+" is not evaluated into a constructor"),new(Function.prototype.bind.apply(r,[null].concat(c(e.arguments,t))))}(e,t);default:throw new Error("Unsupported expression type: "+e.type)}}function c(e,t){return e.reduce(((e,r)=>{const n=i(r,t);return n instanceof o?e.push(...n.items()):e.push(n),e}),[])}function d(e,t){var r=i(e.object,t);return!r&&e.conditional?[]:e.computed?[r,r[i(e.property,t)]]:[r,r[e.property.name]]}function u(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n instanceof Object&&t in n)return n}return null}function l(e){throw new Error(e)}function p(e,t){throw new Error(e.message+' in expression "'+t+'"')}},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n),void 0===a||(e.exports=a)},4443:(e,t,r)=>{var n,a;n=[t,r(6584),r(6400)],a=function(e,t,r){"use strict";class n{static async getUpdatedItemsFromMutationDetail(e,t,r){const{add:a,remove:s,update:o}=e??{},i=new Map;for(const[e,r]of t.entries())i.set(r.key,e);let c=[...t];return s&&(c=n._removeItemsFromDetail(s,c,i)),a&&(c=await n._addItemsFromDetail(a,c,i,r)),o&&(c=await n._updateItemsFromDetail(o,c,i,r)),c}static _addItemsAtEnd(e,t,r){const n=[...r];return e.forEach(((e,r)=>{const a={data:e,key:t[r]?.key,metadata:t[r]};n.push(a)})),n}static _addItemsAtIndices(e,t,r,n){const a=[...n];return e.forEach(((e,n)=>{const s={data:t[n],key:r[n]?.key,metadata:r[n]};e>=0?a.splice(e,0,s):a.push(s)})),a}static _addItemsBeforeKeys(e,t,r,a){const s=[],o=[];return e.forEach((e=>{s.push(n._getIndexByKey(a,e)),o.push({key:e})})),n._addItemsAtIndices(s,t,o,r)}static async _addItemsFromDetail(e,t,r,a){const{addBeforeKeys:s,afterKeys:o,data:i,indexes:c,keys:d,metadata:u}=e;let l=[...t],p=i||[],h=u||[];if(0===p.length&&d?.size){const e=await n._fetchDataByKeys(a,d)??[];p=e.map((e=>e.data)),h=e.map((e=>e.metadata))}return 0===h.length&&d?.size&&(h=[...d].map((e=>({key:e})))),p.length&&(l=c?.length?n._addItemsAtIndices(c,p,h,l):s?.length?n._addItemsBeforeKeys(s,p,l,r):o?.size?n._addItemsBeforeKeys([...o],p,l,r):n._addItemsAtEnd(p,h,l)),l}static async _fetchDataByKeys(e,t){const r=[],n=(await e.fetchByKeys({keys:t})).results;for(const e of t)if(n.has(e)){const t=n.get(e);r.push({...t,key:e})}return r}static _getIndexByKey(e,t){return e.has(t)?e.get(t):-1}static _removeItemsAtIndices(e,t){const r=[...t];return e.sort(((e,t)=>t-e)),e.forEach((e=>{e<r.length&&r.splice(e,1)})),r}static _removeItemsAtKeys(e,t,r){const a=[];return e.forEach((e=>{const t=n._getIndexByKey(r,e);-1!==t&&a.push(t)})),n._removeItemsAtIndices(a,t)}static _removeItemsFromDetail(e,t,r){const{indexes:a,keys:s}=e;let o=[...t];return a?.length?o=n._removeItemsAtIndices(a,o):s?.size&&(o=n._removeItemsAtKeys(s,o,r)),o}static _updateItemsAtIndices(e,t,r,n){const a=[...n];return e.forEach(((e,n)=>{if(a[e]){const s={data:t[n],key:r[n]?.key,metadata:r[n]};a.splice(e,1,s)}})),a}static _updateItemsAtKeys(e,t,r,n,a){const s=[...n];return e.forEach((e=>{const n=this._getIndexByKey(a,e),o={data:t[n],key:r[n]?.key,metadata:r[n]};n>=0&&s.splice(n,1,o)})),s}static async _updateItemsFromDetail(e,t,r,a){const{data:s,indexes:o,keys:i,metadata:c}=e;let d=[...t],u=s||[],l=c||[];if(0===u.length&&i?.size){const e=await n._fetchDataByKeys(a,i)??[];u=e.map((e=>e.data)),l=e.map((e=>e.metadata))}return 0===l.length&&i?.size&&(l=[...i].map((e=>({key:e})))),u.length&&(o?.length?d=n._updateItemsAtIndices(o,u,l,d):i?.size&&(d=n._updateItemsAtKeys(i,u,l,d,r))),d}}class a{constructor(e,t,r){this._handleMutateEvent=async e=>{const{detail:t}=e,r=this._addBusyState("updating data from mutation event"),a=await n.getUpdatedItemsFromMutationDetail(t,this._currentData,this._dataProvider);r?.(),this._currentData=a,this._callback?.onDataUpdated?.(a)},this._handleRefreshEvent=e=>{this._fetchDataAndNotify()},this._addBusyState=t,this._callback=r,this._dataProvider=e,this._currentData=[],e.addEventListener("refresh",this._handleRefreshEvent),e.addEventListener("mutate",this._handleMutateEvent),this._fetchDataAndNotify()}destroy(){this._callback=void 0,this._currentData=[],this._dataProvider.removeEventListener("refresh",this._handleRefreshEvent),this._dataProvider.removeEventListener("mutate",this._handleMutateEvent)}async _fetchData(){const e=[],t=this._dataProvider.fetchFirst({size:-1});for await(const r of t){const t=r.data.map(((e,t)=>({data:e,key:r.metadata[t].key,metadata:r.metadata[t]})));e.push(...t)}return this._currentData=e.slice(),e}async _fetchDataAndNotify(){const e=this._addBusyState("fetching data"),t=await this._fetchData();this._callback?.onDataUpdated?.(t),e()}}e.withDataProvider=function(e,n){var s;return(s=class extends r.Component{constructor(e){super(e),this._handleDataUpdate=e=>{this.setState({fetchedData:e})},this.state={fetchedData:[]}}componentDidMount(){this._initDataProviderHandler()}componentDidUpdate(e){this.props.data!==e.data&&this._resetDataProviderHandler()}componentWillUnmount(){this._releaseDataProviderHandler()}render(r,a){const{data:s,addBusyState:o,...i}=r,{fetchedData:c}=a,d={[n]:c,...i};return t.jsx(e,{...d})}_initDataProviderHandler(){const{data:e,addBusyState:t}=this.props;null!=e&&(this._dataProviderHandler=new a(e,t,{onDataUpdated:this._handleDataUpdate}))}_releaseDataProviderHandler(){this._dataProviderHandler?.destroy(),this._dataProviderHandler=void 0}_resetDataProviderHandler(){this._releaseDataProviderHandler(),this._initDataProviderHandler()}}).displayName=`WithDataProvider(${function(e){return e.displayName??e.name??"Component"}(e)})`,s},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n),void 0===a||(e.exports=a)},1857:(e,t)=>{var r;r=function(e){"use strict";e.ExpParser=function(){function e(e){for(var t=e.expr,r=t.charCodeAt(e.index);32===r||9===r||10===r||13===r;)r=t.charCodeAt(++e.index)}function t(a){var s,o,i=a.expr,c=function(e){var t,a,s,o,i,c,d,u,l;if(c=n(e),!(a=r(e)))return c;for(i={value:a,prec:k(a)},(d=n(e))||$("Expected expression after "+a,e.index),o=[c,i,d];(a=r(e))&&0!==(s=k(a));){for(i={value:a,prec:s},l=a;o.length>2&&s<=o[o.length-2].prec;)d=o.pop(),t=D(a=o.pop().value,c=o.pop(),d,e),o.push(t);(t=n(e))||$("Expected expression after "+l,e.index),o.push(i,t)}for(t=o[u=o.length-1];u>1;)t=D(o[u-1].value,o[u-2],t,e),u-=2;return t}(a);return e(a),i.charCodeAt(a.index)!==m?c:(a.index++,(s=t(a))||$("Expected expression",a.index),e(a),i.charCodeAt(a.index)===v?(a.index++,(o=t(a))||$("Expected expression",a.index),{type:8,test:c,consequent:s,alternate:o}):void $("Expected :",a.index))}function r(t){var r=t.expr;e(t);for(var n=r.substr(t.index,P),a=n.length;a>0;){if(E[n]&&(!U(r.charCodeAt(t.index))||t.index+n.length<r.length&&!F(r.charCodeAt(t.index+n.length))))return t.index+=a,n;n=n.substr(0,--a)}return!1}function n(r){var x,m,g,A=r.expr;if(e(r),j(x=A.charCodeAt(r.index))||x===c)return function(e){for(var t,r,n=e.expr,a="";j(n.charCodeAt(e.index));)a+=n.charAt(e.index++);if(n.charCodeAt(e.index)===c)for(a+=n.charAt(e.index++);j(n.charCodeAt(e.index));)a+=n.charAt(e.index++);if("e"===(t=n.charAt(e.index))||"E"===t){for(a+=n.charAt(e.index++),"+"!==(t=n.charAt(e.index))&&"-"!==t||(a+=n.charAt(e.index++));j(n.charCodeAt(e.index));)a+=n.charAt(e.index++);j(n.charCodeAt(e.index-1))||$("Expected exponent ("+a+n.charAt(e.index)+")",e.index)}return U(r=n.charCodeAt(e.index))?$("Variable names cannot start with a number ("+a+n.charAt(e.index)+")",e.index):r===c&&$("Unexpected period",e.index),{type:3,value:parseFloat(a),raw:a}}(r);if(x===u||x===l||x===f)return i(r);if(x===_)return function(r){var n=r.expr;r.index++;for(var o,i=[],c=0,p=n.length;r.index<p&&!o;){e(r);var h=n.charCodeAt(r.index);if(h===b)o=!0,r.index++;else if(h===d)r.index++,++c!==i.length&&$("Unexpected token ,",r.index);else{var f;f=h===u||h===l?a(r).value:s(r).name,e(r),(h=n.charCodeAt(r.index))!==v&&$("Expected ':'. Found "+String.fromCharCode(h),r.index),r.index++;var x=r.writer;"_ko_property_writers"===f&&(r.writer=1);try{i.push({key:f,value:t(r)})}finally{r.writer=x}}}return o||$("Expected "+String.fromCharCode(b),r.index),{type:10,properties:i}}(r);for(g=(m=A.substr(r.index,w)).length;g>0;){if(m in C&&(!U(A.charCodeAt(r.index))||r.index+m.length<A.length&&!F(A.charCodeAt(r.index+m.length))))return r.index+=g,{type:5,operator:m,argument:n(r),prefix:!0};m=m.substr(0,--g)}var E=r.index,P=r.index+8;return"function"!==A.substring(E,P)||F(A.charCodeAt(P))?!(!U(x)&&x!==p)&&i(r):(r.index=P,function(r){var n=r.expr;e(r);var a=n.charCodeAt(r.index);a!==p&&$("Expected (,",r.index),r.index++;var s=o(r,h,!0);e(r),(a=n.charCodeAt(r.index))!==_&&$("Expected {,",r.index),r.index++,e(r);var i,c=r.index,d=r.index;"return"===n.substring(d,d+6)&&(i=!0,r.index+=6),e(r);var u=t(r);return e(r),(a=n.charCodeAt(r.index))===y&&(r.index++,e(r)),(a=n.charCodeAt(r.index))!==b&&$("Expected },",r.index),r.index++,{type:11,arguments:s,body:u,expr:n.substring(c,r.index-1),return:i}}(r))}function a(e){for(var t,r=e.expr,n="",a=r.charAt(e.index++),s=!1,o=r.length;e.index<o;){if((t=r.charAt(e.index++))===a){s=!0;break}if("\\"===t)switch(t=r.charAt(e.index++)){case"n":n+="\n";break;case"r":n+="\r";break;case"t":n+="\t";break;case"b":n+="\b";break;case"f":n+="\f";break;case"v":n+="\v";break;default:n+=t}else n+=t}return s||$('Unclosed quote after "'+n+'"',e.index),{type:3,value:n,raw:a+n+a}}function s(t,r){var n,a=t.expr,s=a.charCodeAt(t.index),o=t.index;U(s)?t.index++:$("Unexpected "+a.charAt(t.index),t.index);for(var c=a.length;t.index<c&&F(s=a.charCodeAt(t.index));)t.index++;if("new"===(n=a.slice(o,t.index))&&!r){e(t);var d=i(t,4);return 4!==d.type&&$("Expression of type: "+d.type+" not supported for constructor expression"),{type:12,callee:d.callee,arguments:d.arguments}}return N.has(n)?{type:3,value:N.get(n),raw:n}:{type:1,name:n}}function o(r,n,a){for(var o,i,c=r.expr,u=c.length,l=[],p=!1,f=0;r.index<u;){if(e(r),(o=c.charCodeAt(r.index))===n){p=!0,r.index++,n===h&&f&&f>=l.length&&$("Unexpected token "+String.fromCharCode(n),r.index);break}if(o===d){if(r.index++,++f!==l.length)if(n===h)$("Unexpected token ,",r.index);else if(n===x)for(var m=l.length;m<f;m++)l.push(null)}else(!(i=a?s(r):t(r))||l.length>f)&&$("Expected comma",r.index),l.push(i)}return p||$("Expected "+String.fromCharCode(n),r.index),l}function i(r,n){var i,d,y=r.expr;for(d=(i=y.charCodeAt(r.index))===p?function(r){r.index++;var n=t(r);if(e(r),r.expr.charCodeAt(r.index)===h)return r.index++,n;$("Unclosed (",r.index)}(r):i===u||i===l?a(r):i===f?function(e){return e.index++,{type:9,elements:o(e,x)}}(r):s(r),e(r),i=y.charCodeAt(r.index);i===c||i===f||i===p||I(r);){if(r.index++,i===c?(e(r),d={type:2,computed:!1,object:d,property:s(r,!0)}):i===m?(r.index++,e(r),d={type:2,computed:!1,conditional:!0,object:d,property:s(r,!0)}):i===f?(d={type:2,computed:!0,object:d,property:t(r)},e(r),(i=y.charCodeAt(r.index))!==x&&$("Unclosed [",r.index),r.index++):i===p&&(d={type:4,arguments:o(r,h),callee:d}),n===d.type)return d;e(r),i=y.charCodeAt(r.index)}return d}this.parse=function(e){for(var r=e.length,n={index:0,expr:e},a=[];n.index<r;){var s=e.charCodeAt(n.index);if(s===y||s===d)n.index++;else{var o=t(n);o?a.push(o):n.index<r&&$('Unexpected "'+e.charAt(n.index)+'"',n.index)}}return 1===a.length?a[0]:{type:0,body:a}};var c=46,d=44,u=39,l=34,p=40,h=41,f=91,x=93,m=63,y=59,v=58,_=123,b=125;function g(e){return Object.keys(e).reduce((function(e,t){return Math.max(e,t.length)}),0)}var A=!0,C={"-":A,"!":A,"~":A,"+":A},E={"=":1,"||":2,"&&":3,"|":4,"^":5,"&":6,"==":7,"!=":7,"===":7,"!==":7,"<":8,">":8,"<=":8,">=":8,"<<":9,">>":9,">>>":9,"+":10,"-":10,"*":11,"/":11,"%":11},w=g(C),P=g(E),N=new Map;function k(e){return E[e]||0}function D(e,t,r,n){return"="!==e||n.writer||$("Unexpected operator '='",n.index),{type:"||"===e||"&&"===e?7:6,operator:e,left:t,right:r}}function I(e){var t=e.expr;return t.charCodeAt(e.index)===m&&t.charCodeAt(e.index+1)===c&&!j(t.charCodeAt(e.index+2))}function j(e){return e>=48&&e<=57}function U(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!E[String.fromCharCode(e)]}function F(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!E[String.fromCharCode(e)]}function $(e,t){var r=new Error(e+" at character "+t);throw r.index=t,r.description=e,r}N.set("true",!0),N.set("false",!1),N.set("null",null),N.set("undefined",void 0)},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,[t]),void 0===r||(e.exports=r)},5726:(e,t,r)=>{var n,a;n=[t,r(6584),r(6400),r(396),r(7038),r(675)],a=function(e,t,r,n,a,s){"use strict";e.ManageTabStops=function({children:e}){let o=n.useRef(null),i=n.useRef(!1);const{isTabbable:c}=a.useTabbableMode();n.useEffect((()=>{o.current&&(i.current&&c||(s.disableAllFocusableElements(o.current),i.current=!0),c&&s.enableAllFocusableElements(o.current))}),[c]);const d=e;if(d.ref){const e=d.ref;d.ref=t=>{o.current=t,"function"==typeof e?e(t):e.current=t}}else d.ref=o;return t.jsx(r.Fragment,{children:e})},Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n),void 0===a||(e.exports=a)},3778:(e,t,r)=>{var n,a;n=[t,r(9831),r(5447),r(7509),r(1600),r(6400),r(6584),r(9093),r(4443),r(5726),r(5914),r(8819),r(4534),r(4016),r(6818)],a=function(e,t,r,n,a,s,o,i,c,d,u,l,p,h,f){"use strict";i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;class x extends s.Component{constructor(e){super(e),this._resolveConfig=e=>{e.then((t=>{e===this.props.config&&this.setState({view:this._getFragment(t.view),data:t.data})}))},this._getFragment=e=>{const t=new DocumentFragment;return e.forEach((e=>{t.appendChild(e.cloneNode(this))})),t},this.state={view:null,data:null}}componentDidMount(){this._resolveConfig(this.props.config)}componentDidUpdate(e,t){this.props.config!==e.config&&this._resolveConfig(this.props.config)}render(){return o.jsx(s.Fragment,{children:this.state.view&&this.props.executeFragment?this.props.executeFragment(null,this.state.view,this.state.data,this.forceUpdate.bind(this),this.props.bindingProvider):null})}}class m extends s.Component{constructor(e){super(e),this._addBusyState=e=>i.getContext(this.props.componentElement).getBusyContext().addBusyState({description:e}),this.BindForEachWithDP=c.withDataProvider(y,"data")}render(e){return Array.isArray(e.data)?o.jsx(v,{data:e.data,itemRenderer:e.itemRenderer}):o.jsx(this.BindForEachWithDP,{addBusyState:this._addBusyState,data:e.data,itemRenderer:e.itemRenderer})}}class y extends s.Component{render(e){const t=e.data.map((e=>e.data));return o.jsx(v,{data:t,itemRenderer:e.itemRenderer})}}class v extends s.Component{render(){const e=this.props.data;return o.jsx(s.Fragment,{children:e?e.map(((e,t)=>this.props.itemRenderer({data:e,index:t,observableIndex:()=>t}))):[]})}}const _=Symbol(),b=Symbol(),g=Symbol(),A=Symbol(),C=function(e){return e},E="$provided",w=[{type:1,name:"$context"}];class P{constructor(){this._templateAstCache=new WeakMap,this._cspEvaluator=l.getExpressionEvaluator()??new h.CspExpressionEvaluatorInternal}static cleanupTemplateCache(e){e&&e._cachedRows&&(e._cachedRows.forEach((e=>e.dispose())),e._cachedRows=[])}executeFragment(e,t,r,a,s){let o=s;return o||(o=e?n.CustomElementUtils.getElementState(e)?.getBindingProvider():null),!r?.$provided||r.$provided instanceof Map||(r.$provided=new Map(Object.entries(r.$provided))),this._execute({[_]:o,[b]:e,[A]:r},t,r,a)}execute(e,t,r,n,a){const s=t.getAttribute("data-oj-as"),o=this._getContext(n,e,t,r,null,s);return this._execute({[_]:n,[b]:e,[A]:o},t,o,a)}_execute(e,t,r,n){const a=this._getAstViaCache(e,t),o=e[_];if(o){t._cachedRows||Object.defineProperties(t,{_cachedRows:{writable:!0,value:[]}});const e=o.__KoComputed((()=>{if(o.__KoIsInitial())return this._cspEvaluator.evaluate(a,{$context:r,$h:s.h,BindDom:x});P.cleanupTemplateCache(t),n()}));return t._cachedRows.push(e),e()}return this._cspEvaluator.evaluate(a,{$context:r,$h:s.h,BindDom:x})}_getContext(e,r,n,a,s,o){if(e){let i=e.__ContextFor(n);return i||(t.info(`Binding context not found when processing template for element with id: ${r.id}. Using binding context for element instead.`),i=e.__ContextFor(r)),e.__ExtendBindingContext(i,a,s,o,r)}const i={$current:a};return o&&(i[o]=a),i}_getAstViaCache(e,t){let n=this._templateAstCache.get(t);if(!n){if(11===t.nodeType)n=this._createAst(e,Array.from(t.childNodes));else{const a=r.getTemplateContent(t)[0];n=this._createAst(e,Array.from(a.childNodes))}this._templateAstCache.set(t,n)}return n}_createAst(e,t){const r={type:9,elements:[]};return r.elements=Array.prototype.reduce.call(t,((t,r)=>{const n=this._processSpecialNodes(e,r);return n?t.push(n):3===r.nodeType?t.push({type:3,value:r.nodeValue}):1===r.nodeType&&t.push(this._createElementNode(e,r)),t}),[]),r}_processSpecialNodes(e,t){if(1===t.nodeType)switch(t.tagName.toLowerCase()){case"oj-bind-text":return this._createExpressionNode(e,t.getAttribute("value"));case"oj-bind-if":return this._createIfExpressionNode(e,t);case"oj-bind-for-each":return this._createBindForEachExpressionNode(e,t);case"oj-bind-dom":return this._createBindDomExpressionNode(e,t);case"oj-bind-template-slot":return this._createBindTemplateNode(e,t);case"oj-defer":return this._createDeferNode(e,t);case"template":return this._createTemplateWithRenderCallback(e,t)}return null}_createBindTemplateNode(e,t){const r={type:10,properties:[]},n=t.getAttribute("name")||"";r.properties.push(this._getAttribute(e,"name",n));const a=t.getAttribute("data");a&&r.properties.push(this._getAttribute(e,"data",a));const o=t.getAttribute("as");return this._createCallNodeWithContext(((r,n)=>{const a=n.data,i=n.name,c=e[A].__oj_slots[i];let d=c&&c[c.length-1],u=!1;if(!d)for(let e in t.childNodes)if("TEMPLATE"===t.childNodes[e].nodeName){d=t.childNodes[e],u=!0;break}if(d&&d.render)return d.render(a);if(d){const t=this._getAstViaCache(e,d),r=d.getAttribute("data-oj-as"),n=this._getContext(e[_],u?e[b]:e[A].__oj_composite,d,a,u?o:null,r);return this._cspEvaluator.evaluate(t,{$context:n,$h:s.h,BindDom:x})}}),[r])}_createTemplateWithRenderCallback(e,t){const r=t.getAttribute("data-oj-as"),n=this._getAstViaCache.bind(this),a=this._cspEvaluator,o={key:"render",value:{type:3,value:(o,i)=>{const c=Object.assign({},e[A],{$current:o});if(r&&(c[r]=o),c.$provided&&i){const e=new Map([...c.$provided,...i]);c.$provided=e}else i&&(c.$provided=i);const d={[A]:c,[_]:e[_],[b]:e[b],[g]:e[g]},u=n(d,t);return a.evaluate(u,{$context:c,$h:s.h})}}};let i=this._getElementProps(e,t);return i.push(o),e[_]&&i.push({key:"data-oj-use-ko",value:{type:3,value:""}}),this._createHFunctionCallNode("template",[{type:10,properties:i}])}_createDeferContent(e,t,r){const n={view:t,data:r},a={config:Promise.resolve(n),bindingProvider:e[_],executeFragment:this.executeFragment.bind(this)};return s.h(x,a)}_createDeferNode(e,t){let r,n=this._createDeferContent(e,[],{});const a=[{key:"ref",value:{type:3,value:e=>{e?(r=e,s.render(n,r)):s.render(null,r)}}},{key:"_activateSubtree",value:this._createCallNodeWithContext((r=>a=>{n=this._createDeferContent(e,Array.from(t.childNodes),r),s.render(n,a)}))}];let o=this._getElementProps(e,t);return o=o.concat(a),this._createHFunctionCallNode("oj-defer",[{type:10,properties:o}])}_createIfExpressionNode(e,t){if(!t.hasAttribute("test"))throw new Error("Missing the retuired 'test' attribute on <oj-bind-if>");return{type:5,operator:"...",argument:{type:8,test:this._createExpressionNode(e,t.getAttribute("test")),consequent:this._createAst(e,Array.from(t.childNodes)),alternate:{type:3,value:[]}}}}_createBindForEachExpressionNode(e,t){const r=t.getElementsByTagName("template")[0];if(!r)throw new Error("Template not found: oj-bind-for-each requires a single template element as its direct child");return this._createComponentNode(e,t,m,[{key:"itemRenderer",value:this._createNestedTemplateRendererNode(e,r)},{key:"componentElement",value:{type:3,value:e[b]}}])}_createNestedTemplateRendererNode(e,t){const r=t.getAttribute("data-oj-as"),n={[_]:e[_],[A]:e[A],[b]:e[b],[g]:(e,t)=>"function"!=typeof t||"$current.observableIndex"!==e&&e!==`${r}.observableIndex`?t:t()},a=this._getAstViaCache(n,t);return this._createCallNodeWithContext((e=>t=>{const n={$current:t};null!=r&&(n[r]=t);const o=Object.assign({},e,n);return this._cspEvaluator.evaluate(a,{$context:o,$h:s.h})}))}_createElementNode(e,t){const r=this._getElementProps(e,t),n=t.tagName,s=n.toLowerCase(),o=a.getMetadata(n),i=this._createHFunctionCallNode(s,[this._createPossiblyProvidedAndConsumedProperties(s,e,o,r),this._createAst(e,Array.from(t.childNodes))]);return t.hasAttribute("data-oj-manage-tabs")?this._createComponentNode(e,null,d.ManageTabStops,[{key:"children",value:i}]):i}_createPossiblyProvidedAndConsumedProperties(e,t,r,a){const s={type:10,properties:a},o=u.getPropagationMetadataViaCache(e,r);if(!o)return s;const i=new Set;a.reduce(((e,t)=>e.add(t.key)),i);const c=[],d=this._getUnwrapObservable(t);for(const[e,t]of o){const r=t[1];r&&(e===u.CONSUMED_CONTEXT?c.push({key:"__oj_private_contexts",value:this._createCallNodeWithContext((e=>{const t=new Map,n=d(e)?.[E];return r.forEach((e=>{n?.has(e)&&t.set(e,d(n.get(e)))})),t}))}):i.has(e)||i.has(n.AttributeUtils.propertyNameToAttribute(e).toUpperCase())||c.push({key:e,value:this._createCallNodeWithContext((e=>{const t=d(e)?.[E];if(t)return d(t.get(r.name))}))}))}const l=0===c.length?s:{type:10,properties:s.properties.concat(c)},p=r.properties;return this._createCallNodeWithContext(((t,r)=>{let a,s=new Map;for(const[t,[i]]of o)i&&i.forEach((o=>{let i,c=!0;if(t===u.STATIC_PROPAGATION)c=!1;else if(r.hasOwnProperty(t))i=r[t];else{const a=n.AttributeUtils.propertyNameToAttribute(t),s=a.toUpperCase();if(r.hasOwnProperty(s)){i=r[s];const o=p?.[t]?.type;o&&null!=i&&(i=n.AttributeUtils.parseAttributeValue(e,a,i,o))}else c=!1}const d="default";if(c){const e=o.transform;i=e&&e.hasOwnProperty(i)?e[i]:i}else o.hasOwnProperty(d)&&(i=o[d],c=!0);c&&(a=!0,s.set(o.name,i))}));if(a){const e=t[E];void 0!==e&&(s=new Map([...e,...s])),t[E]=s}return r}),[l])}_createBindDomExpressionNode(e,t){if(!t.hasAttribute("config"))throw new Error("Missing the required 'config' attribute on <oj-bind-dom>");const r=t.attributes.config.value;return this._createComponentNode(e,t,x,[this._createPropertyNode(e,"config",r,(e=>Promise.resolve(e))),{key:"bindingProvider",value:{type:3,value:e[_]}},{key:"executeFragment",value:{type:3,value:this.executeFragment.bind(this)}}])}_createComponentNode(e,t,r,n){let a=t?this._getElementProps(e,t):[];return a=n?a.concat(n):a,this._createHFunctionCallNode(r,[{type:10,properties:a}])}_createPropertyNode(e,t,r,n){return{key:t,value:this._createExpressionNode(e,r,n)}}_postprocessClassNameValue(e){let t;return t=Array.isArray(e)?e.join(" "):"string"!=typeof e?Object.keys(e).reduce(((t,r)=>(e[r]&&t.push(r),t)),[]).join(" "):e,t}_getElementProps(e,t){let r;const s=[],o=[],i=new Map,c=new Map,d=Array.prototype.reduce.call(t.attributes,((d,u)=>{let l=u.name;const h=u.value;if(l.startsWith(":")){l=l.substring(1);const t=l.split(".");2===t.length&&"style"===t[0]?s.push({k:t[1],v:h}):"style"===l?r=h:"class"===l?d.push(this._createPropertyNode(e,"className",h,this._postprocessClassNameValue)):(l=n.AttributeUtils.isGlobalOrData(l)?n.AttributeUtils.getGlobalPropForAttr(l):n.AttributeUtils.attributeToPropertyName(l),d.push(this._createPropertyNode(e,l,h)))}else{const r=n.AttributeUtils.getExpressionInfo(h);if(n.AttributeUtils.isEventListenerAttr(l))l=n.AttributeUtils.eventAttrToPreactPropertyName(l),c.set(l,h);else if(n.AttributeUtils.isGlobalOrData(l))d.push(this._createPropertyNode(e,n.AttributeUtils.getGlobalPropForAttr(l),h));else if(r.expr){const s=n.AttributeUtils.attributeToPropertyName(l),c=s.split("."),u=p.getPropertyMetadata(c[0],a.getPropertiesForElementTag(t.tagName));if(u?.readOnly||(c.length>1?o.push({subProps:s,expr:r.expr}):d.push({key:s,value:this._createExpressionEvaluator(e,r.expr)})),!r.downstreamOnly){let e=c;const t=e.shift();let n=i.get(t);n=n?[...n,{expr:r.expr,subProps:e}]:[{expr:r.expr,subProps:e}],i.set(t,n)}}else d.push({key:l.toUpperCase(),value:{type:3,value:h}})}return d}),[]);if(null!=r){if(s.length>0)throw new Error("Binding the entire style attribute as well as the individual style properties on the same element is not supported");d.push(this._createPropertyNode(e,"style",r))}else s.length>0&&d.push({key:"style",value:{type:10,properties:s.map((t=>this._createPropertyNode(e,n.AttributeUtils.attributeToPropertyName(t.k),t.v)))}});return o.length>0&&d.push(this._createRefPropertyNodeForNestedProps(e,o)),i.forEach(((t,r)=>{const a=`on${r}Changed`,s=c.get(a);s&&c.delete(a),d.push(this._createWritebackPropertyNode(e,r,a,t,n.AttributeUtils.getExpressionInfo(s)?.expr))})),c.forEach(((e,t)=>{const r=n.AttributeUtils.getExpressionInfo(e);r.expr&&d.push(this._createEventListenerPropertyNode(t,r.expr))})),d}_createRefPropertyNodeForNestedProps(e,t){const r={type:9,elements:t.map((({subProps:t,expr:r})=>({type:10,properties:[{key:t,value:this._createExpressionEvaluator(e,r)}]})))},n=P._nestedPropsRefCallback;return{key:"ref",value:this._createCallNodeWithContext(Function.prototype.bind.bind(n,e[_]),[r])}}static _nestedPropsRefCallback(e,t,r){if(r&&r.setProperties){const e=Object.assign({},...t);r.setProperties(e)}}_createWritebackPropertyNode(e,t,r,n,a){const s=[];let o;return{key:r,value:this._createCallNodeWithContext((r=>i=>{n.forEach(((n,a)=>{let o=i.detail.value;var c=n.subProps,d=n.expr;c.length>0&&"object"==typeof o&&(o=c.reduce(((e,t)=>e[t]),o));let u=s[a];u||(u=this._cspEvaluator.createEvaluator(d).evaluate,s.push(u));const l=u([r,r.$data]);let p;if(e[_]&&e[_].__IsObservable(l))p=l;else{const e=this._getPropertyWriterExpression(d);if(null!==e){const t=this._cspEvaluator.createEvaluator(e).evaluate;p=this._getWriter(t([r.$data||{},r]))}}f.performMonitoredWriteback(t,p,i,o)})),a&&!o&&(o=this._cspEvaluator.createEvaluator(a).evaluate);const c=o?o([r,r.$data]):null;c&&c(i,r.$current||r.$data,r)}))}}_createEventListenerPropertyNode(e,t){let r;return{key:e,value:this._createCallNodeWithContext((e=>n=>{r||(r=this._cspEvaluator.createEvaluator(t).evaluate);const a=r([e,e.$data]);a&&a(n,e.$current||e.$data,e)}))}}_createExpressionNode(e,t,r){const a=n.AttributeUtils.getExpressionInfo(t);return a.expr?this._createExpressionEvaluator(e,a.expr,r):{type:3,value:t}}_createExpressionEvaluator(e,t,r){const n=this._cspEvaluator.createEvaluator(t).evaluate;return this._createCallNodeWithContext((a=>{const s=this._getUnwrapObservable(e),o=s(a);let i=s(n([o,o.$data]));return e[g]&&(i=e[g](t,i)),r?r(i):i}))}_getUnwrapObservable(e){const t=e[_];return t?t.__UnwrapObservable:C}_createCallNodeWithContext(e,t){return{type:4,callee:{type:3,value:e},arguments:t?w.concat(t):w}}_createHFunctionCallNode(e,t){return{type:4,callee:{type:1,name:"$h"},arguments:[{type:3,value:e},...t]}}_getAttribute(e,t,r){const a=n.AttributeUtils.getExpressionInfo(r).expr;return{key:t,value:a?this._createExpressionEvaluator(e,a):{type:3,value:r}}}_getWriter(e){return e._ko_property_writers}_getPropertyWriterExpression(e){if(null==e||["true","false","null","undefined"].indexOf(e)>=0)return null;const t=(e=e.trim()).match(/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i);return null===t?null:`{_ko_property_writers: function(v){${t[1]?`Object(${t[1]})${t[2]}`:e}=v;}}`}}const N=new P,k=N.executeFragment.bind(N),D=N.execute.bind(N),I=P.cleanupTemplateCache;e.cleanupTemplateCache=I,e.execute=D,e.executeFragment=k,Object.defineProperty(e,"__esModule",{value:!0})}.apply(t,n),void 0===a||(e.exports=a)}}]);
//# sourceMappingURL=778.10fc2c3423c443bd821d.js.map